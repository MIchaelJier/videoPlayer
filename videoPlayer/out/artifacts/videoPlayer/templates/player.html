<!DOCTYPE html>
<html lang="">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
<title>播放中...</title>

<link rel="stylesheet" type="text/css" href="css/reset.css"/>
<link rel="stylesheet" href="bootstrap/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="css/willesPlay.css"/>
<script src="js/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
<script src="js/bootstrap.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<!-- 代码 开始 -->
<div class="container">
    <!--导航栏 开始-->
    <nav class="nav navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <!--在移动端的时候导航条折叠起来，三横的样式出现，点击该样式可以显示或隐藏导航条上的内容-->
                <button class="navbar-toggle" data-toggle="collapse" data-target="#menu">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="#" class="navbar-brand">J视频</a>
            </div>
            <div id="menu" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/homepage">首页</a></li>
                    <li class="active"><a href="#">播放中...</a></li>
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        其他<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="/findvideo">搜索</a></li>
                            <li><a href="#" id="findus">关于我们</a></li>
                        </ul>
                    </li>
                </ul>
                <ul class="nav navbar-nav pull-right">
                    <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown" id="name_">
                        登录<span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="/selfpage">个人首页</a></li>
                            <li><a href="/index">登录</a></li>
                            <li><a href="/register">注册</a></li>
                            <li id="clear_cookies"><a href="#">注销</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!--导航栏 结束-->
    <div class="row" id="ture_Box">
            <div class="col-md-12">
                <div id="willesPlay">
                    <!--播放标题 开始-->
                    <div class="playHeader">
                        <div class="videoName">视频</div>
                    </div>
                    <!--播放标题 结束-->
                    <!--播放可视区 开始-->
                    <div class="playContent">
                        <video width="100%" height="100%" id="playVideo" src="#">
                        </video>
                        <div class="playTip glyphicon glyphicon-play"></div>
                    </div>
                    <!--播放可视区 结束-->
                    <!--弹幕控制区 开始-->
                    <div class="barrage">
                        <p class="title">弹幕:</p>
                        <input type="text" class="text" id="text">
                        <button type="button" class="btn btn-warning glyphicon glyphicon-share-alt"></button>
                    </div>
                    <!--弹幕控制区 结束-->
                    <!--播放控制区 开始-->
                    <div class="playControll">
                        <div class="playPause playIcon"></div>
                        <!--播放控制区 时间 开始-->
                        <div class="timebar">
                            <div class="glyphicon glyphicon-backward"></div>
                            <span class="currentTime">0:00:00</span>
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped active"
                                     role="progressbar" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
                                </div>
                            <span class="duration">0:00:00</span>
                            <div class="glyphicon glyphicon-forward"></div>
                        </div>
                        <!--播放控制区 时间 结束-->
                        <!--播放控制区 其他控制 开始-->
                        <div class="otherControl">
                            <span class="volume glyphicon glyphicon-volume-down"></span>
                            <div class="btn-group dropup" id="speed">
                                <a class="dropdown-toggle" data-toggle="dropdown"><strong>1X</strong></a>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a rel="0.5"><b>0.5倍速</b></a></li>
                                    <li><a rel="1"><b>1倍速</b></a></li>
                                    <li><a rel="1.5"><b>1.5倍速</b></a></li>
                                    <li><a rel="2"><b>2倍速</b></a></li>
                                </ul>
                            </div>
                            <div class="btn-group dropup" id="morebox">
                                <a class="dropdown-toggle" data-toggle="dropdown"><strong>More</strong></a>
                                <ul class="dropdown-menu" role="menu">
                                    <li>
                                        <a href="#">本地播放 <input type='button' class="btn btn-success" value='选取'  OnClick='javascript:$("#file").click();'/></a>
                                        <input value="本地视频播放" type="file" id="file" style="display: none">
                                    </li>
                                    <li><a href="#" class="btnLight">来自优酷的视频</a></li>
                                </ul>
                            </div>
                            <div class="volumeBar">
                                 <div class="volumewrap">
                                  <div class="progress">
                                        <div class="progress-bar" role="progressbar"
                                             aria-valuemin="0" aria-valuemax="100" style="width: 8px;height: 40%;"></div>
                                    </div>
                                 </div>
                            </div>
                            <span class="fullScreen glyphicon glyphicon-fullscreen"></span>
                        </div>
                        <!--播放控制区 其他控制 结束-->
                    <!--播放控制区 结束-->
                        <!-- 模态框（Modal）开始 -->
                        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
                                        </button>
                                        <h4 class="modal-title" id="myModalLabel">视频问题互动</h4>
                                    </div>
                                    <div class="modal-body">
                                        <h4>11111</h4><br>
                                        <label><input type="radio" name="optionsRadios" value="A" checked><a></a></label><br>
                                        <label><input type="radio" name="optionsRadios" value="B" checked><a></a></label><br>
                                        <label><input type="radio" name="optionsRadios" value="C" checked><a></a></label><br>
                                        <label><input type="radio" name="optionsRadios" value="D" checked><a></a></label><br>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-primary">提交答案</button>
                                    </div>
                                </div><!-- /.modal-content -->
                            </div><!-- /.modal-dialog -->
                        </div><!-- /.modal -->
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- 代码 结束 -->
</body>
<script src="js/Playbarrage.js" type="text/javascript" charset="utf-8"></script>
<script src="js/willesPlay.js" type="text/javascript" charset="utf-8"></script>
<script>
    $(function() {
        //通用
        var q = new Array();
        var videosrc = $.getUrlParam('dv');
        var cl = $('#clear_cookies');
        if ($.cookie('name')) {
            var Uname = $.cookie('name');
            $('#name_').html(Uname + "<span class=\"caret\"></span>");
            $.ajax({
                url: "/returnquestion",
                data: {vname: videosrc},
                type: 'POST',
                dataType : 'json',
                success: function (result) {
                    if(result){
                        q = result;
                        console.log(q);
                    }
                }
            });
            cl.prev().prev().click(function () {
                if(confirm("是否注销并退出？")) {
                    $.cookie('name', '', { expires: -1 });
                    $.cookie('history', '', { expires: -1 });
                    window.location.href = "/index";
                }else{
                    return false;
                }
            });
        }else{
            alert("非法登录！");
            window.location.href = "/homepage";
        }
        cl.click(function () {
            if ($.cookie('name')) {
                $.cookie('name', '', {expires: -1});
                $.cookie('history', '', { expires: -1 });
                alert("注销成功");
                $('#name_').html("登录<span class=\"caret\"></span>");
                window.location.href = "/homepage";
            }
        });
        cl.prev().prev().prev().click(function () {
            if(!$.cookie('name')){
                alert("非法登录！");
                window.location.href = "/homepage";
            }else {
                window.location.href = "/selfpage";
            }
        });
        $('#findus').click(function () {
            var url = '/findus';
            var name = '关于我们';
            var iWidth = '300';
            var iHeight = '50';
            var iTop = (window.screen.height-30-iHeight)/2;
            var iLeft = (window.screen.width-10-iWidth)/2;
            window.open(url,name,'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        });
        $('.btnLight').click(function () {
            $('.playContent').html('<embed src=\'http://player.youku.com/player.php/sid/XNDE4MDQ5MDY4NA==/v.swf\' allowFullScreen=\'true\' quality=\'high\' width=\'100%\' height=\'650px\' allowScriptAccess=\'always\' type=\'application/x-shockwave-flash\' />\n')
            $('.playControll').html('<button class=\'btn btn-success\' style=\'float:right;height:100%;\'>返回</button>');
            var btnsrc ="/player?dv="+videosrc;
            $('.playControll button').click(function () {
                window.location.href = btnsrc;
            });
        });
        var playVideo = $('video');
        var i = 0;
        setInterval(function () {
            console.log(q.length);
            var ct = parseInt(playVideo[0].currentTime);
            if(i > q.length - 1){i = q.length - 1}
            if(q.length!=0){
                if(ct == q[i].qtime) {
                    console.log(q.length);
                    $('#myModal').modal({keyboard: true});
                    playVideo[0].pause();
                    var qmain = q[i].question.split('|');
                    $('.modal-body h4').html(qmain[0]);
                    $('.modal-body a:eq(0)').html(qmain[1]);
                    $('.modal-body a:eq(1)').html(qmain[2]);
                    $('.modal-body a:eq(2)').html(qmain[3]);
                    $('.modal-body a:eq(3)').html(qmain[4]);
                    console.log(q[i].ans);
                    i++;
                }
            }
        },1000);
        $('.modal-footer button').click(function () {
            var userans = $('.modal-body input:radio:checked').val();
            if(q[i-1].ans == userans){
                alert('正确');
                $('#myModal').modal('hide');
                playVideo[0].currentTime++;
            }else{
                alert('错误,再试一次吧');
            }
        });
        $('#myModal').on('hide.bs.modal',function () {
            playVideo[0].play();
        });
    });
</script>
</html>
